const svgVk = `<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M8 0C3.58187 0 0 3.58171 0 8C0 12.4183 3.58187 16 8 16C12.4181 16 16 12.4183 16 8C16 3.58171 12.4181 0 8 0ZM12.058 8.86523C12.4309 9.22942 12.8254 9.57217 13.1601 9.97402C13.3084 10.1518 13.4482 10.3356 13.5546 10.5423C13.7065 10.8371 13.5693 11.1604 13.3055 11.1779L11.6665 11.1776C11.2432 11.2126 10.9064 11.0419 10.6224 10.7525C10.3957 10.5219 10.1853 10.2755 9.96698 10.037C9.87777 9.93915 9.78382 9.847 9.67186 9.77449C9.44843 9.62914 9.2543 9.67366 9.1263 9.90707C8.99585 10.1446 8.96606 10.4078 8.95362 10.6721C8.93577 11.0586 8.81923 11.1596 8.43147 11.1777C7.60291 11.2165 6.81674 11.0908 6.08606 10.6731C5.44147 10.3047 4.94257 9.78463 4.50783 9.19587C3.66126 8.04812 3.01291 6.78842 2.43036 5.49254C2.29925 5.2007 2.39517 5.04454 2.71714 5.03849C3.25205 5.02817 3.78697 5.02948 4.32188 5.03799C4.53958 5.04143 4.68362 5.166 4.76726 5.37142C5.05633 6.08262 5.4107 6.75928 5.85477 7.38684C5.97311 7.55396 6.09391 7.72059 6.26594 7.83861C6.45582 7.9689 6.60051 7.92585 6.69005 7.71388C6.74734 7.57917 6.77205 7.43513 6.78449 7.29076C6.82705 6.79628 6.83212 6.30195 6.75847 5.80943C6.71263 5.50122 6.53929 5.30218 6.23206 5.24391C6.07558 5.21428 6.0985 5.15634 6.17461 5.06697C6.3067 4.91245 6.43045 4.81686 6.67777 4.81686L8.52951 4.81653C8.82136 4.87382 8.88683 5.00477 8.92645 5.29874L8.92808 7.35656C8.92464 7.47032 8.98521 7.80751 9.18948 7.88198C9.35317 7.936 9.4612 7.80473 9.55908 7.70112C10.0032 7.22987 10.3195 6.67368 10.6029 6.09801C10.7279 5.84413 10.8358 5.58142 10.9406 5.31822C11.0185 5.1236 11.1396 5.02785 11.3593 5.03112L13.1424 5.03325C13.195 5.03325 13.2483 5.03374 13.3004 5.04274C13.6009 5.09414 13.6832 5.22345 13.5903 5.5166C13.4439 5.97721 13.1596 6.36088 12.8817 6.74553C12.5838 7.15736 12.2661 7.55478 11.9711 7.96841C11.7001 8.34652 11.7215 8.53688 12.058 8.86523Z" fill="#9873FF"/>
</svg>
`;
const svgFb = `<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M7.99999 0C3.6 0 0 3.60643 0 8.04819C0 12.0643 2.928 15.3976 6.75199 16V10.3775H4.71999V8.04819H6.75199V6.27309C6.75199 4.25703 7.94399 3.14859 9.77599 3.14859C10.648 3.14859 11.56 3.30121 11.56 3.30121V5.28514H10.552C9.55999 5.28514 9.24799 5.90362 9.24799 6.53815V8.04819H11.472L11.112 10.3775H9.24799V16C11.1331 15.7011 12.8497 14.7354 14.0879 13.2772C15.3261 11.819 16.0043 9.96437 16 8.04819C16 3.60643 12.4 0 7.99999 0Z" fill="#9873FF"/>
</svg>
`;
const svgPhone = `<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<g opacity="0.7">
<circle cx="8" cy="8" r="8" fill="#9873FF"/>
<path d="M11.56 9.50222C11.0133 9.50222 10.4844 9.41333 9.99111 9.25333C9.83556 9.2 9.66222 9.24 9.54222 9.36L8.84444 10.2356C7.58667 9.63556 6.40889 8.50222 5.78222 7.2L6.64889 6.46222C6.76889 6.33778 6.80444 6.16444 6.75556 6.00889C6.59111 5.51556 6.50667 4.98667 6.50667 4.44C6.50667 4.2 6.30667 4 6.06667 4H4.52889C4.28889 4 4 4.10667 4 4.44C4 8.56889 7.43556 12 11.56 12C11.8756 12 12 11.72 12 11.4756V9.94222C12 9.70222 11.8 9.50222 11.56 9.50222Z" fill="white"/>
</g>
</svg>
`;
const svgEmail = `<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path opacity="0.7" fill-rule="evenodd" clip-rule="evenodd" d="M8 16C12.4183 16 16 12.4183 16 8C16 3.58172 12.4183 0 8 0C3.58172 0 0 3.58172 0 8C0 12.4183 3.58172 16 8 16ZM4 5.75C4 5.3375 4.36 5 4.8 5H11.2C11.64 5 12 5.3375 12 5.75V10.25C12 10.6625 11.64 11 11.2 11H4.8C4.36 11 4 10.6625 4 10.25V5.75ZM8.424 8.1275L11.04 6.59375C11.14 6.53375 11.2 6.4325 11.2 6.32375C11.2 6.0725 10.908 5.9225 10.68 6.05375L8 7.625L5.32 6.05375C5.092 5.9225 4.8 6.0725 4.8 6.32375C4.8 6.4325 4.86 6.53375 4.96 6.59375L7.576 8.1275C7.836 8.28125 8.164 8.28125 8.424 8.1275Z" fill="#9873FF"/>
</svg>
`;
const svgOther = `<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path opacity="0.7" fill-rule="evenodd" clip-rule="evenodd" d="M8 16C12.4183 16 16 12.4183 16 8C16 3.58172 12.4183 0 8 0C3.58172 0 0 3.58172 0 8C0 12.4183 3.58172 16 8 16ZM3 8C3 5.24 5.24 3 8 3C10.76 3 13 5.24 13 8C13 10.76 10.76 13 8 13C5.24 13 3 10.76 3 8ZM9.5 6C9.5 5.17 8.83 4.5 8 4.5C7.17 4.5 6.5 5.17 6.5 6C6.5 6.83 7.17 7.5 8 7.5C8.83 7.5 9.5 6.83 9.5 6ZM5 9.99C5.645 10.96 6.75 11.6 8 11.6C9.25 11.6 10.355 10.96 11 9.99C10.985 8.995 8.995 8.45 8 8.45C7 8.45 5.015 8.995 5 9.99Z" fill="#9873FF"/>
</svg>`;

const svgPreloadMain = `<svg width="80" height="80" viewBox="0 0 80 80" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M4.00025 40.0005C4.00025 59.8825 20.1182 76.0005 40.0002 76.0005C59.8822 76.0005 76.0002 59.8825 76.0002 40.0005C76.0002 20.1185 59.8823 4.00049 40.0003 4.00049C35.3513 4.00048 30.9082 4.88148 26.8282 6.48648" stroke="#9873FF" stroke-width="8" stroke-miterlimit="10" stroke-linecap="round"/>
</svg>`;

const svgPreloadBtn = `<svg width="13" height="13" viewBox="0 0 13 13" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M1.00008 6.04008C1.00008 8.82356 3.2566 11.0801 6.04008 11.0801C8.82356 11.0801 11.0801 8.82356 11.0801 6.04008C11.0801 3.2566 8.82356 1.00008 6.04008 1.00008C5.38922 1.00008 4.7672 1.12342 4.196 1.34812" stroke-width="2" stroke-miterlimit="10" stroke-linecap="round"/>
</svg>
`;

const getClients = async () => {
  try {
    const response = await fetch('http://localhost:3000/api/clients', {
      method: 'GET'
    });

    const result = await response.json();

    return result;
  } catch (error) {
    console.log(error);
  }
}

const sendClientData = async (client, method, id = null) => {
  try {
    const response = await fetch(`http://localhost:3000/api/clients/${method === 'POST' ? '' : id}`, {
      method,
      body: JSON.stringify(client)
    });

    const result = await response.json();

    return result;
  } catch (error) {
    console.log(error);
  }
}

const deleteClientItem = async (id) => {
  try {
    const response = await fetch(`http://localhost:3000/api/clients/${id}`, {
      method: 'DELETE',
    });

  } catch (error) {
    console.log(error);
  }
}

const findClient = async (value) => {
  try {
    const response = await fetch(`http://localhost:3000/api/clients?search=${value}`, {
      method: 'GET'
    });

    const result = await response.json();

    return result;
  } catch (error) {
    console.log(error);
  }
}

const validateClientForm = () => {
  const userName = document.getElementById('movingName');
  const userSurname = document.getElementById('movingSurname');
  const userLastName = document.getElementById('movingMiddlename');
  const unacceptableLetter = document.getElementById('unacceptableLetter');
  const writeName = document.getElementById('writeName');
  const writeSurname = document.getElementById('writeSurname');
  const writeLastName = document.getElementById('writeLastName');
  const requiredValue = document.getElementById('requiredValue');
  const validateArray = [unacceptableLetter, writeName, writeSurname, writeLastName, requiredValue];
  const regexp = /[^а-яА-ЯёЁ]+$/g;

  const onInputValue = input => {
    input.addEventListener('input', () => {
      input.style.borderColor = 'var(--color-gray-suit)';
      for (const item of validateArray) {
        item.textContent = '';
      }
    });

    input.oncut = input.oncopy = input.onpast = () => {
      input.style.borderColor = 'var(--color-gray-suit)';
      for (const item of validateArray) {
        item.textContent = '';
      }
    };

    input.onchange = () => {
      input.style.borderColor = 'var(--color-gray-suit)';
      if (userSurname.value && userName.value && userLastName.value) {
        for (const item of validateArray) {
          item.textContent = '';
        }
      }
    };
  };
  onInputValue(userName);
  onInputValue(userSurname);
  onInputValue(userLastName);

  const checkRequiredName = (input, message, name) => {
    if (!input.value) {
      input.style.borderColor = 'var(--color-burnt-sienna)';
      message.textContent = `Введите ${name} клиента!`;
      return false;
    } else {
      message.textContent = '';
    }
    return true;
  }

  const checkByRegexp = (input, regexp) => {
    if (regexp.test(input.value)) {
      input.style.borderColor = 'var(--color-burnt-sienna)';
      unacceptableLetter.textContent = `Недопустимые символы`;
      return false;
    }

    return true;
  };

  if (!checkRequiredName(userSurname, writeSurname, 'Фамилию')) { return false };
  if (!checkRequiredName(userName, writeName, 'Имя')) { return false };
  if (!checkRequiredName(userLastName, writeLastName, 'Отчество')) { return false };
  if (!checkByRegexp(userName, regexp)) { return false };
  if (!checkByRegexp(userSurname, regexp)) { return false };
  if (!checkByRegexp(userLastName, regexp)) { return false };

  return true;
}

const validateClientContact = (contactType, contactInput) => {
  const writeValue = document.getElementById('writeName');
  const onlyNumbers = /[^0-9]+$/g;
  const onlyEmail = /[^a-zA-Z|@|.]+$/g;

  const onInputValue = input => {
    input.addEventListener('input', () => {
      input.style.borderColor = 'var(--color-gray-suit)';
      writeValue.textContent = '';
    });

    input.oncut = input.oncopy = input.onpast = () => {
      input.style.borderColor = 'var(--color-gray-suit)';
      writeValue.textContent = '';
    }
  };

  const showErrorMessage = (message, block, input) => {
    block.textContent = message;
    input.style.borderColor = 'var(--color-burnt-sienna)';
  };

  onInputValue(contactInput);

  if (!contactInput.value) {
    showErrorMessage('Заполните все контакты', writeValue, contactInput);
    return false;
  }

  switch (contactType.innerHTML) {
    case 'Телефон':
      if (onlyNumbers.test(contactInput.value)) {
        showErrorMessage('Можно ввести только цифры', writeValue, contactInput);
        return false;
      } else if (contactInput.value.length !== 11) {
        showErrorMessage('Введено меньше 11 цифр', writeValue, contactInput);
        return false;
      }

      return true;
    case 'Email':
      if (onlyEmail.test(contactInput.value)) {
        showErrorMessage('Email введен неверно', writeValue, contactInput);
        return false;
      }
      return true;
    default:
      return true;
  }
};


const createHeader = () => {
  const header = document.createElement('header');
  const logo = document.createElement('a');
  const logoImg = document.createElement('img');
  const formHeader = document.createElement('form');
  const inputHeader = document.createElement('input');
  const container = document.createElement('div');
  const wrapper = document.createElement('div');
  const inner = document.createElement('div');
  const findList = document.createElement('ul');

  findList.classList.add('find-list', 'hide');
  header.classList.add('header'); container.classList.add('container', 'header__container');
  logo.classList.add('logo', 'header__logo');
  logoImg.classList.add('logo__img');
  logoImg.src = 'img/logo-header.svg';
  logoImg.alt = 'LogoCRM';
  formHeader.classList.add('header__form');
  inputHeader.classList.add('header__input');
  inputHeader.placeholder = 'Введите запрос';
  wrapper.classList.add('header__wrapper');
  inner.classList.add('header__inner');

  inner.append(inputHeader, findList);
  header.append(container);
  logo.append(logoImg);
  formHeader.append(inner);
  container.append(logo);
  container.append(formHeader);

  return header;
}

const createSection = () => {
  const svgBtn = `<svg width="23" height="16" viewBox="0 0 23 16" xmlns="http://www.w3.org/2000/svg">
  <path d="M14.5 8C16.71 8 18.5 6.21 18.5 4C18.5 1.79 16.71 0 14.5 0C12.29 0 10.5 1.79 10.5 4C10.5 6.21 12.29 8 14.5 8ZM5.5 6V3H3.5V6H0.5V8H3.5V11H5.5V8H8.5V6H5.5ZM14.5 10C11.83 10 6.5 11.34 6.5 14V16H22.5V14C22.5 11.34 17.17 10 14.5 10Z" />
  </svg>`;
  const main = document.createElement('main');
  const section = document.createElement('section');
  const container = document.createElement('div');
  const h1 = document.createElement('h1');
  const sortThead = document.createElement('thead');
  const sortTr = document.createElement('tr');
  const sortID = document.createElement('th');
  const sortName = document.createElement('th');
  const sortCreat = document.createElement('th');
  const sortEdit = document.createElement('th');
  const sortContacts = document.createElement('th');
  const sortAction = document.createElement('th');
  const sortLetters = document.createElement('span');
  const addClientBtn = document.createElement('btn');
  const addClientBtnSvg = document.createElement('span');
  const tableContainer = document.createElement('div');
  const table = document.createElement('table');
  const tableTbody = document.createElement('tbody');
  const tableCreatSpan = document.createElement('span');
  const tableEditSpan = document.createElement('span');

  const sortItems = [sortID, sortName, sortCreat, sortEdit];



  sortID.setAttribute('data-type', 'id');
  sortName.setAttribute('data-type', 'text');
  sortCreat.setAttribute('data-type', 'create');
  sortEdit.setAttribute('data-type', 'update');

  main.classList.add('main');
  container.classList.add('container', 'clients__container');
  section.classList.add('clients');
  tableContainer.classList.add('clients__table-container');
  h1.classList.add('clients__title');
  tableTbody.classList.add('clients__tbody');
  sortThead.classList.add('clients__sort', 'sort');
  sortID.classList.add('sort__item', 'sort__item_id', 'sort--up');
  sortName.classList.add('sort__item', 'sort__item_name', 'sort--down');
  sortCreat.classList.add('sort__item', 'sort__item_create', 'sort--down');
  sortEdit.classList.add('sort__item', 'sort__item_edit', 'sort--down');
  sortContacts.classList.add('sort__item', 'sort__item_contacts');
  sortAction.classList.add('sort__item', 'sort__item_action');
  sortLetters.classList.add('sort__letters');
  addClientBtn.classList.add('clients__btn', 'btn-reset');
  addClientBtnSvg.classList.add('clients__svg');
  table.classList.add('clients__table');
  tableCreatSpan.classList.add('table__creat');
  tableEditSpan.classList.add('table__edit');

  for (const item of sortItems) {
    item.addEventListener('click', () => {
      if (item.classList.contains('sort--down')) {
        item.classList.remove('sort--down');
        item.classList.add('sort--up');
      } else {
        item.classList.remove('sort--up');
        item.classList.add('sort--down');
      }
    });
  }

  sortCreat.addEventListener('click', () => {
    if (sortCreat.classList.contains('sort--down')) {
      tableCreatSpan.classList.add('sort--up');
    } else {
      tableCreatSpan.classList.remove('sort--up');
    }
  });
  sortEdit.addEventListener('click', () => {
    if (sortEdit.classList.contains('sort--down')) {
      tableEditSpan.classList.add('sort--up');
    } else {
      tableEditSpan.classList.remove('sort--up');
    }
  });

  h1.textContent = 'Клиенты';
  sortID.textContent = 'ID';
  sortName.textContent = 'Фамилия Имя Отчество';
  sortLetters.textContent = 'А-Я';
  sortCreat.textContent = 'Дата и время ';
  sortEdit.textContent = 'Последние ';
  sortContacts.textContent = 'Контакты';
  sortAction.textContent = 'Действия';
  addClientBtn.textContent = 'Добавить клиента';
  addClientBtnSvg.innerHTML = svgBtn;

  addClientBtn.addEventListener('click', () => {
    document.body.append(addClientsModal())
  })

  main.append(section);
  section.append(container);
  sortName.append(sortLetters);
  sortCreat.append(tableCreatSpan);
  sortEdit.append(tableEditSpan);
  sortTr.append(
    sortID,
    sortName,
    sortCreat,
    sortEdit,
    sortContacts,
    sortAction
  );
  sortThead.append(sortTr);
  tableContainer.append(table, createPreloader());
  table.append(sortThead, tableTbody);
  addClientBtn.prepend(addClientBtnSvg);
  container.append(
    h1,
    tableContainer,
    addClientBtn
  );

  return {
    main,
    table,
    tableTbody
  }
}

const creatModuleForm = () => {
  const contactsSvgDefult = `<svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M6.99998 3.66683C6.63331 3.66683 6.33331 3.96683 6.33331 4.3335V6.3335H4.33331C3.96665 6.3335 3.66665 6.6335 3.66665 7.00016C3.66665 7.36683 3.96665 7.66683 4.33331 7.66683H6.33331V9.66683C6.33331 10.0335 6.63331 10.3335 6.99998 10.3335C7.36665 10.3335 7.66665 10.0335 7.66665 9.66683V7.66683H9.66665C10.0333 7.66683 10.3333 7.36683 10.3333 7.00016C10.3333 6.6335 10.0333 6.3335 9.66665 6.3335H7.66665V4.3335C7.66665 3.96683 7.36665 3.66683 6.99998 3.66683ZM6.99998 0.333496C3.31998 0.333496 0.333313 3.32016 0.333313 7.00016C0.333313 10.6802 3.31998 13.6668 6.99998 13.6668C10.68 13.6668 13.6666 10.6802 13.6666 7.00016C13.6666 3.32016 10.68 0.333496 6.99998 0.333496ZM6.99998 12.3335C4.05998 12.3335 1.66665 9.94016 1.66665 7.00016C1.66665 4.06016 4.05998 1.66683 6.99998 1.66683C9.93998 1.66683 12.3333 4.06016 12.3333 7.00016C12.3333 9.94016 9.93998 12.3335 6.99998 12.3335Z" fill="#9873FF"/>
  </svg>`;
  const contactsSvgHover = `<svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" clip-rule="evenodd" d="M0.333313 7.00016C0.333313 3.32016 3.31998 0.333496 6.99998 0.333496C10.68 0.333496 13.6666 3.32016 13.6666 7.00016C13.6666 10.6802 10.68 13.6668 6.99998 13.6668C3.31998 13.6668 0.333313 10.6802 0.333313 7.00016ZM6.33329 4.33366C6.33329 3.96699 6.63329 3.66699 6.99996 3.66699C7.36663 3.66699 7.66663 3.96699 7.66663 4.33366V6.33366H9.66663C10.0333 6.33366 10.3333 6.63366 10.3333 7.00033C10.3333 7.36699 10.0333 7.66699 9.66663 7.66699H7.66663V9.66699C7.66663 10.0337 7.36663 10.3337 6.99996 10.3337C6.63329 10.3337 6.33329 10.0337 6.33329 9.66699V7.66699H4.33329C3.96663 7.66699 3.66663 7.36699 3.66663 7.00033C3.66663 6.63366 3.96663 6.33366 4.33329 6.33366H6.33329V4.33366Z" fill="#9873FF"/>
  </svg>`;
  const title = document.createElement('h2');
  const btnClose = document.createElement('button');
  const form = document.createElement('form');
  const inputName = document.createElement('input');
  const labelName = document.createElement('label');
  const inputSurname = document.createElement('input');
  const labelSurname = document.createElement('label');
  const inputMiddlename = document.createElement('input');
  const labelMiddlename = document.createElement('label');
  const requiredName = document.createElement('span');
  const requiredSurname = document.createElement('span');
  const btnAddContacts = document.createElement('button');
  const btnContactsSvg = document.createElement('span');
  const btnContactsSvgHover = document.createElement('span');
  const btnSave = document.createElement('button');
  const btnCancel = document.createElement('button');
  const contactsBlock = document.createElement('div');
  const formMovingName = document.createElement('div');
  const formMovingSurname = document.createElement('div');
  const formMovingMiddlename = document.createElement('div');
  const saveSpinner = document.createElement('span');

  const errorBlock = document.createElement('p');
  const unacceptableLetter = document.createElement('span');
  const writeName = document.createElement('span');
  const writeSurname = document.createElement('span');
  const writeLastName = document.createElement('span');
  const requiredValue = document.createElement('span');
  const requiredContacts = document.createElement('span');

  saveSpinner.classList.add('modal__spinner');
  title.classList.add('modal__title');
  btnClose.classList.add('btn__close', 'btn-reset');
  form.classList.add('modal__form');
  formMovingName.classList.add('form__moving');
  formMovingSurname.classList.add('form__moving');
  formMovingMiddlename.classList.add('form__moving');
  inputName.classList.add('modal__input');
  inputSurname.classList.add('modal__input');
  inputMiddlename.classList.add('modal__input');
  labelName.classList.add('modal__label');
  labelSurname.classList.add('modal__label');
  labelMiddlename.classList.add('modal__label');
  requiredName.classList.add('modal__label');
  requiredSurname.classList.add('modal__label');
  btnAddContacts.classList.add('modal__btn-contacts', 'modal__btn-contacts--active')
  btnSave.classList.add('modal__btn-save', 'btn-reset', 'site-btn');
  btnCancel.classList.add('modal__btn-cancel', 'btn-reset');
  btnContactsSvg.classList.add('btn-contacts__svg', 'btn-contacts__svg--defult', 'btn-contacts__svg--active');
  btnContactsSvgHover.classList.add('btn-contacts__svg', 'btn-contacts__svg--hover');
  contactsBlock.classList.add('modal__contact');
  labelName.for = 'movingName';
  labelSurname.for = 'movingSurname';
  labelMiddlename.for = 'movingMiddlename';
  inputName.id = 'movingName';
  inputSurname.id = 'movingSurname';
  inputMiddlename.id = 'movingMiddlename';
  inputName.type = 'text';
  inputSurname.type = 'text';
  inputMiddlename.type = 'text';
  inputName.placeholder = 'Имя';
  inputSurname.placeholder = 'Фамилия';
  inputMiddlename.placeholder = 'Отчество';

  errorBlock.classList.add('modal__error');
  unacceptableLetter.id = 'unacceptableLetter';
  writeName.id = 'writeName';
  writeSurname.id = 'writeSurname';
  writeLastName.id = 'writeLastName';
  requiredValue.id = 'requiredValue';
  requiredContacts.id = 'requiredContacts';


  title.textContent = 'Новый клиент';
  labelName.textContent = 'Имя';
  labelSurname.textContent = 'Фамилия';
  labelMiddlename.textContent = 'Отчество';
  btnAddContacts.textContent = 'Добавить контакт';
  btnSave.textContent = 'Сохранить';
  btnCancel.textContent = 'Отменить';
  requiredName.textContent = '*';
  requiredSurname.textContent = '*';
  btnContactsSvg.innerHTML = contactsSvgDefult;
  btnContactsSvgHover.innerHTML = contactsSvgHover;
  saveSpinner.innerHTML = svgPreloadBtn;

  btnSave.append(saveSpinner);
  labelName.append(requiredName);
  labelSurname.append(requiredSurname);
  formMovingName.append(inputName, labelName);
  formMovingSurname.append(inputSurname, labelSurname);
  formMovingMiddlename.append(inputMiddlename, labelMiddlename);
  contactsBlock.append(btnAddContacts);
  errorBlock.append(writeName, writeSurname, writeLastName, requiredValue, unacceptableLetter, requiredContacts);
  form.append(
    formMovingName,
    formMovingSurname,
    formMovingMiddlename,
    contactsBlock,
    errorBlock,
    btnSave,
    btnCancel
  );
  btnAddContacts.append(btnContactsSvg, btnContactsSvgHover);

  btnAddContacts.addEventListener('click', (e) => {
    e.preventDefault();
    const contactsItems = document.getElementsByClassName('contact');

    if (contactsItems.length < 9) {
      const contactItem = createContactItem();
      contactsBlock.prepend(contactItem.contact);
      contactsBlock.style.backgroundColor = 'var(--color-athens-gray)';
      if (contactsItems.length >= 5) {
        document.querySelector('.site-modal__content').style.top = '70%';
      } else {
        document.querySelector('.site-modal__content').style.top = '50%';
      }
    } else {
      const contactItem = createContactItem();
      contactsBlock.prepend(contactItem.contact);
      btnAddContacts.classList.remove('modal__btn-contacts--active');
    }
  })

  btnAddContacts.addEventListener('mousemove', () => {
    btnContactsSvg.classList.remove('btn-contacts__svg--active');
    btnContactsSvgHover.classList.add('btn-contacts__svg--active');
  })
  btnAddContacts.addEventListener('mouseleave', () => {
    btnContactsSvg.classList.add('btn-contacts__svg--active');
    btnContactsSvgHover.classList.remove('btn-contacts__svg--active');
  })

  return {
    form,
    btnClose,
    title,
    btnCancel,
    inputName,
    inputSurname,
    inputMiddlename,
    labelName,
    labelSurname,
    labelMiddlename,
    contactsBlock,
    btnAddContacts
  }
}

const contactTooltip = (type, value) => {
  const tooltip = document.createElement('div');
  const tooltipType = document.createElement('span');
  const tooltipValue = document.createElement('a');

  tooltip.classList.add('contact-tooltip', 'site-tooltip');
  tooltipType.classList.add('contact-tooltip__type');
  tooltipValue.classList.add('contact-tooltip__value');

  tooltipType.textContent = type + ': ';
  tooltipValue.textContent = value;

  tooltip.append(tooltipType, tooltipValue);

  return {
    tooltip,
    tooltipType,
    tooltipValue
  }
}

const createPreloader = () => {
  const preloaderBlock = document.createElement('div');
  const preloaderCircle = document.createElement('span');

  preloaderBlock.classList.add('preloader');
  preloaderCircle.id = 'loader';

  preloaderCircle.innerHTML = svgPreloadMain;

  preloaderBlock.append(preloaderCircle);

  return preloaderBlock;

}

const createContactItem = () => {
  const svgDelete = `<svg width="12" height="12" viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg">
  <path d="M6 0C2.682 0 0 2.682 0 6C0 9.318 2.682 12 6 12C9.318 12 12 9.318 12 6C12 2.682 9.318 0 6 0ZM6 10.8C3.354 10.8 1.2 8.646 1.2 6C1.2 3.354 3.354 1.2 6 1.2C8.646 1.2 10.8 3.354 10.8 6C10.8 8.646 8.646 10.8 6 10.8ZM8.154 3L6 5.154L3.846 3L3 3.846L5.154 6L3 8.154L3.846 9L6 6.846L8.154 9L9 8.154L6.846 6L9 3.846L8.154 3Z"/>
  </svg>`
  const contact = document.createElement('div');
  const contactType = document.createElement('div');
  const contactName = document.createElement('button');
  const contactList = document.createElement('ul');
  const contactPhone = document.createElement('li');
  const contactVk = document.createElement('li');
  const contactFb = document.createElement('li');
  const contactEmail = document.createElement('li');
  const contactOther = document.createElement('li');
  const contactInput = document.createElement('input');
  const contactDelete = document.createElement('button');
  const contactDeleteTooltip = document.createElement('span');

  contact.classList.add('contact');
  contactDeleteTooltip.classList.add('contact-tooltip', 'site-tooltip');
  contactType.classList.add('contact__type');
  contactName.classList.add('contact__name');
  contactList.classList.add('contact__list', 'list-reset');
  contactPhone.classList.add('contact__item');
  contactVk.classList.add('contact__item');
  contactFb.classList.add('contact__item');
  contactEmail.classList.add('contact__item');
  contactOther.classList.add('contact__item');
  contactInput.classList.add('contact__input');
  contactDelete.classList.add('contact__delete', 'btn-reset');

  contactName.textContent = 'Телефон';
  contactDeleteTooltip.textContent = 'Удалить контакт';
  contactPhone.textContent = 'Телефон';
  contactVk.textContent = 'VK';
  contactFb.textContent = 'Facebook';
  contactEmail.textContent = 'Email';
  contactOther.textContent = 'Другое';
  contactInput.placeholder = 'Введите данные контакта';
  contactInput.type = 'text';
  contactDelete.innerHTML = svgDelete;

  contactDelete.addEventListener('click', (e) => {
    e.preventDefault();
    contact.remove();
    document.querySelector('.modal__btn-contacts').classList.add('modal__btn-contacts--active');
  });

  contactName.addEventListener('click', (e) => {
    e.preventDefault();
    contactList.classList.toggle('contact__list--active');
    contactName.classList.toggle('contact__list--active');
  });

  contactType.addEventListener('mouseleave', (e) => {
    contactList.classList.remove('contact__list--active');
    contactName.classList.remove('contact__list--active');
  });

  const setType = (type) => {
    type.addEventListener('click', () => {
      contactName.textContent = type.textContent;
      contactList.classList.toggle('contact__list--active');
      contactName.classList.toggle('contact__list--active');
    });
  }

  const typesArray = [contactEmail, contactFb, contactVk, contactPhone, contactOther];
  for (const type of typesArray) {
    setType(type);
  }

  contactDelete.append(contactDeleteTooltip);
  contact.append(contactType, contactInput, contactDelete);
  contactType.append(contactName, contactList);
  contactList.append(contactPhone, contactEmail, contactVk, contactFb, contactOther);

  return {
    contact,
    contactName,
    contactInput,
    contactDelete
  }
}

const editClientModal = (data) => {
  const editModal = document.createElement('div');
  const editModalContent = document.createElement('div');
  const createForm = creatModuleForm();
  const titleId = document.createElement('span');

  titleId.classList.add('modal__id');
  editModal.classList.add('modal-edit', 'site-modal', 'modal--active');
  editModalContent.classList.add('edit-modal__content', 'site-modal__content', 'modal--active');

  titleId.textContent = 'ID: ' + data.id.substr(2, 6);
  createForm.title.textContent = 'Изменить данные';
  createForm.btnCancel.textContent = 'Удалить клиента';

  createForm.btnCancel.addEventListener('click', (e) => {
    e.preventDefault();

    const deleteModal = deleteClientModal();
    document.body.append(deleteModal.deleteModal);

    deleteModal.deleteModalDelete.addEventListener('click', () => {
      try {
        deleteModal.deleteSpinner.style.display = 'block';
        setTimeout(() => {
          deleteClientItem(data.id);
          document.getElementById(data.id).remove();
          deleteModal.deleteModal.remove();
          document.querySelector('.modal-edit').remove();
        }, 1500);
      } catch (error) {
        console.log(error);
      }
      finally {
        setTimeout(() => deleteModal.deleteSpinner.style.display = 'none', 1500);
      }
    });

  });

  createForm.btnClose.addEventListener('click', () => {
    editModal.remove();
  });
  document.addEventListener('click', (e) => {
    if (e.target === editModal) {
      editModal.remove();
    }
  });

  createForm.inputName.value = data.name;
  createForm.inputSurname.value = data.surname;
  createForm.inputMiddlename.value = data.lastName;


  for (const contact of data.contacts) {
    const createContact = createContactItem();

    createContact.contactName = contact.type;
    createContact.contactInput.value = contact.value;

    createForm.contactsBlock.prepend(createContact.contact);
    createForm.contactsBlock.style.backgroundColor = 'var(--color-athens-gray)';
  }

  if (data.contacts.length === 10) {
    createForm.btnAddContacts.classList.remove('modal__btn-contacts--active');
  }

  createForm.form.addEventListener('submit', async (e) => {
    e.preventDefault();
    if (!validateClientForm()) {
      return;
    }

    const contactTypes = document.querySelectorAll('.contact__name');
    const contactValues = document.querySelectorAll('.contact__input');
    let contacts = [];
    let client = {};

    for (let i = 0; i < contactTypes.length; i++) {
      if (!validateClientContact(contactTypes[i], contactValues[i])) {
        return;
      }
      contacts.push({
        type: contactTypes[i].innerHTML,
        value: contactValues[i].value
      });
    }

    client.name = createForm.inputName.value;
    client.surname = createForm.inputSurname.value;
    client.lastName = createForm.inputMiddlename.value;
    client.contacts = contacts;
    console.log(client);

    const spinner = document.querySelector('.modal__spinner');

    try {
      spinner.style.display = 'block'
      const editData = await sendClientData(client, 'PATCH', data.id);
      setTimeout(() => {
        document.getElementById(editData.id).remove();
        document.querySelector('.clients__tbody').append(ctreateClientItem(editData));
        document.querySelector('.modal-edit').remove();
      }, 1500);
    } catch (error) {
      console.log(error);
    } finally {
      setTimeout(() => spinner.style.display = 'none', 1500);

    }

  })

  createForm.title.append(titleId);
  editModalContent.append(createForm.btnClose, createForm.title, createForm.form);
  editModal.append(editModalContent);

  return {
    editModal,
    editModalContent
  }

}

const deleteClientModal = () => {
  const deleteModalContent = document.createElement('div');
  const modalClose = document.createElement('button');
  const deleteModalTitle = document.createElement('h2');
  const deleteModalText = document.createElement('p');
  const deleteModal = document.createElement('div');
  const deleteModalDelete = document.createElement('button');
  const deleteModalBack = document.createElement('button');
  const deleteSpinner = document.createElement('span');

  deleteSpinner.classList.add('modal__spinner');
  deleteModal.classList.add('delete-modal', 'site-modal', 'modal--active');
  deleteModalContent.classList.add('delete-modal__content', 'site-modal__content', 'modal--active');
  deleteModalText.classList.add('delete-modal__text');
  deleteModalTitle.classList.add('delte-modal__title', 'modal__title');
  deleteModalDelete.classList.add('delete-modal__delete', 'btn-reset', 'site-btn');
  deleteModalBack.classList.add('delete-modal__back', 'btn-reset');
  modalClose.classList.add('btn__close', 'btn-reset');

  deleteSpinner.innerHTML = svgPreloadBtn;
  deleteModalTitle.textContent = 'Удалить клиента';
  deleteModalText.textContent = 'Вы действительно хотите удалить данного клиента?';
  deleteModalDelete.textContent = 'Удалить';
  deleteModalBack.textContent = 'Отмена';

  deleteModalDelete.append(deleteSpinner);
  deleteModalContent.append(
    modalClose,
    deleteModalTitle,
    deleteModalText,
    deleteModalDelete,
    deleteModalBack
  )
  deleteModal.append(deleteModalContent);

  window.addEventListener('click', (e) => {
    if (e.target === deleteModal) {
      deleteModal.remove();
    }
  })

  modalClose.addEventListener('click', () => deleteModal.remove());
  deleteModalBack.addEventListener('click', () => deleteModal.remove());

  return {
    deleteModal,
    deleteModalContent,
    deleteModalDelete,
    deleteSpinner
  }
}



const createContactLink = (type, value, element, svg, item) => {
  const setTooltip = contactTooltip(type, value);
  element = document.createElement('a');
  element.classList.add('contacts__link');
  element.innerHTML = svg;

  if (type === 'Email') {
    element.href = `mailto:${value.trim()}`
  } else if (type === 'Телефон') {
    element.href = `tel:${value.trim()}`;
    setTooltip.tooltipValue.style.color = 'var(--color-white)';
    setTooltip.tooltipValue.style.textDecoration = 'none';
  } else {
    element.href = value.trim();
  }
  element.append(setTooltip.tooltip);
  item.append(element);
}

const createContactType = (type, value, item) => {
  switch (type) {
    case 'Телефон':
      let phone;
      createContactLink(type, value, phone, svgPhone, item);
      break;
    case 'Facebook':
      let fb;
      createContactLink(type, value, fb, svgFb, item);
      break;
    case 'VK':
      let vk;
      createContactLink(type, value, vk, svgVk, item);
      break;
    case 'Email':
      let email;
      createContactLink(type, value, email, svgEmail, item);
      break;
    case 'Other':
      let other;
      createContactLink(type, value, other, svgOther, item);
      break;

    default:
      break;
  }
}

const formatDate = data => {
  const newDate = new Date(data);

  const correctDate = {
    year: 'numeric',
    month: 'numeric',
    day: 'numeric',
  }

  const resultDate = newDate.toLocaleString('ru', correctDate);

  return resultDate;
}

const formatTime = data => {
  const newDate = new Date(data);

  const correctDate = {
    hour: 'numeric',
    minute: 'numeric',
  }

  const resultTime = newDate.toLocaleString('ru', correctDate);

  return resultTime;
}



const ctreateClientItem = (data) => {
  const clientTr = document.createElement('tr');
  const clientIdTd = document.createElement('td');
  const clientId = document.createElement('span');
  const clientFullName = document.createElement('td');
  const clientName = document.createElement('span');
  const clientSurName = document.createElement('span');
  const clientMiddleName = document.createElement('span');
  const clientCreated = document.createElement('td');
  const createdDate = document.createElement('span');
  const createdTime = document.createElement('span');
  const clientChanged = document.createElement('td');
  const changedDate = document.createElement('span');
  const changedTime = document.createElement('span');
  const clientContacts = document.createElement('td');
  const clientActions = document.createElement('td');
  const clientEdit = document.createElement('button');
  const clientDelete = document.createElement('button');
  const deleteClient = deleteClientModal();
  const editClient = editClientModal(data);
  const editSpinner = document.createElement('span');
  const deleteSpinner = document.createElement('span');

  editSpinner.classList.add('actions__spinner');
  deleteSpinner.classList.add('actions__spinner');
  clientTr.classList.add('clients__item');
  clientIdTd.classList.add('clients__id');
  clientFullName.classList.add('clients__full-name');
  clientName.classList.add('clients__name');
  clientSurName.classList.add('clients__surname');
  clientMiddleName.classList.add('clients__middlename');
  clientCreated.classList.add('clients__created');
  createdDate.classList.add('created__date');
  createdTime.classList.add('created__time');
  clientChanged.classList.add('clients__changed');
  changedDate.classList.add('changed__date');
  changedTime.classList.add('changed__time');
  clientContacts.classList.add('clients__contacts');
  clientActions.classList.add('clients__actions');
  clientDelete.classList.add('clients__delete', 'btn-reset');
  clientEdit.classList.add('clients__edit', 'btn-reset');

  for (const contact of data.contacts) {
    createContactType(contact.type, contact.value, clientContacts);
  }

  const deleteById = () => {
    deleteClient.deleteModalDelete.addEventListener('click', () => {
      try {
        deleteClient.deleteSpinner.style.display = 'block';
        setTimeout(() => {
          deleteClientItem(data.id);
          document.getElementById(data.id).remove();
          deleteClient.deleteModal.remove();
        }, 1500);
      } catch (error) {
        console.log(error);
      }
      finally {
        setTimeout(() => deleteClient.deleteSpinner.style.display = 'none', 1500);
      }
    })
  }

  clientDelete.addEventListener('click', () => {
    deleteSpinner.style.display = 'block';
    clientDelete.classList.add('actions-wait');

    setTimeout(() => {
      deleteById();
      document.body.append(deleteClient.deleteModal)

      deleteSpinner.style.display = 'none';
      clientDelete.classList.remove('actions-wait');
    }, 1500);
  })

  clientEdit.addEventListener('click', () => {
    editSpinner.style.display = 'block';
    clientEdit.classList.add('actions-wait');

    setTimeout(() => {
      document.body.append(editClient.editModal);

      editSpinner.style.display = 'none';
      clientEdit.classList.remove('actions-wait');
    }, 1500);


  })

  editSpinner.innerHTML = svgPreloadBtn;
  deleteSpinner.innerHTML = svgPreloadBtn;
  clientTr.id = data.id;
  clientId.textContent = data.id.substr(4, 6);
  clientName.textContent = data.name;
  clientSurName.textContent = data.surname;
  clientMiddleName.textContent = data.lastName;
  clientEdit.textContent = 'Изменить';
  clientDelete.textContent = 'Удалить';
  createdDate.textContent = formatDate(data.createdAt);
  createdTime.textContent = formatTime(data.createdAt);
  changedDate.textContent = formatDate(data.updatedAt);
  changedTime.textContent = formatTime(data.updatedAt);


  clientIdTd.append(clientId);
  clientFullName.append(clientName, clientSurName, clientMiddleName);
  clientCreated.append(createdDate, createdTime);
  clientChanged.append(changedDate, changedTime);
  clientEdit.append(editSpinner);
  clientDelete.append(deleteSpinner);
  clientActions.append(clientEdit, clientDelete);
  clientTr.append(clientIdTd,
    clientFullName,
    clientCreated,
    clientChanged,
    clientContacts,
    clientActions);

  return clientTr;
}

const addClientsModal = () => {
  const createForm = creatModuleForm();
  const modal = document.createElement('div');
  const modalContent = document.createElement('div');

  modal.classList.add('modal', 'site-modal', 'modal--active');
  modalContent.classList.add('modal__content', 'site-modal__content', 'modal--active');
  createForm.form.classList.add('add-client');

  modal.append(modalContent);
  modalContent.append(
    createForm.btnClose,
    createForm.title,
    createForm.form
  );

  createForm.form.addEventListener('submit', async (e) => {
    e.preventDefault();
    if (!validateClientForm()) {
      return;
    }

    const contactTypes = document.querySelectorAll('.contact__name');
    const contactValues = document.querySelectorAll('.contact__input');
    let contacts = [];
    let clientObj = {};

    for (let i = 0; i < contactTypes.length; i++) {
      if (!validateClientContact(contactTypes[i], contactValues[i])) {
        return;
      }
      contacts.push({
        type: contactTypes[i].innerHTML,
        value: contactValues[i].value
      })
    }

    clientObj.name = createForm.inputName.value;
    clientObj.surname = createForm.inputSurname.value;
    clientObj.lastName = createForm.inputMiddlename.value;
    clientObj.contacts = contacts;
    console.log(clientObj);

    const spinner = document.querySelector('.modal__spinner');

    try {
      spinner.style.display = 'block';
      const data = await sendClientData(clientObj, 'POST');
      setTimeout(() => {
        document.querySelector('.clients__tbody').append(ctreateClientItem(data));
        document.querySelector('.modal').remove();
      }, 1500);
    } catch (error) {
      console.log(error);
    } finally {
      setTimeout(() => spinner.style.display = 'none', 1500);

    }


  })

  createForm.btnClose.addEventListener('click', () => {
    modal.remove();
  });
  document.addEventListener('click', (e) => {
    if (e.target === modal) {
      modal.remove();
    }
  });

  return modal;
}

const sortTable = () => {
  const table = document.querySelector('table');
  const headers = table.querySelectorAll('th');
  const tbody = table.querySelector('tbody');

  const directions = Array.from(headers).map(() => '');

  const transform = (type, content) => {
    switch (type) {
      case 'id':
        return parseFloat(content)
      case 'create':
      case 'update':
        return content.split('.').reverse().join('-');
      case 'text':
      default:
        return content;
    }
  }

  const sortColumn = (index) => {
    const type = headers[index].getAttribute('data-type');
    const rows = tbody.querySelectorAll('tr');
    const direction = directions[index] || 'sortUp';
    const multiply = direction === 'sortUp' ? 1 : -1;
    const newRows = Array.from(rows);

    newRows.sort((row1, row2) => {
      const cellA = row1.querySelectorAll('td')[index].textContent;
      const cellB = row2.querySelectorAll('td')[index].textContent;

      const a = transform(type, cellA);
      const b = transform(type, cellB);
      console.log(a, b);

      switch (true) {
        case a > b:
          return 1 * multiply;
        case a < b:
          return -1 * multiply;
        default:
          break;
        case a === b:
          return 0;
      }
    });

    [].forEach.call(rows, (row) => {
      tbody.removeChild(row);
    });

    directions[index] = direction === 'sortUp' ? 'sortDown' : 'sortUp';

    newRows.forEach(newRow => {
      tbody.appendChild(newRow);
    })
  }

  [].forEach.call(headers, (header, index) => {
    header.addEventListener('click', () => {
      sortColumn(index);
    });
  });
}

const searchClients = (clients) => {
  const findList = document.querySelector('.find-list');
  const input = document.querySelector('.header__input');

  clients.forEach(client => {
    const findItem = document.createElement('li');
    const findLink = document.createElement('a');

    findItem.classList.add('find-list__item');
    findLink.classList.add('find-list__link');

    findLink.textContent = `${client.name} ${client.surname} ${client.lastName}`;
    findLink.href = '#';

    findItem.append(findLink);
    findList.append(findItem);
  });

  const rewriteTable = async (str) => {
    const response = await findClient(str);
    const tbody = document.querySelector('.clients__tbody');
    tbody.innerHTML = '';

    for (const client of response) {
      tbody.append(ctreateClientItem(client));
    }
  }

  input.addEventListener('input', async () => {
    const value = input.value.trim();
    const foundItems = document.querySelectorAll('.find-list__link');

    if (value !== '') {
      rewriteTable(value);

      foundItems.forEach(link => {
        if (link.innerText.search(value) == -1) {
          link.classList.add('hide');
          link.innerHTML = link.innerText;
        } else {
          link.classList.remove('hide');
          findList.classList.remove('hide');
          const str = link.innerText;
          link.innerHTML = insertMark(str, link.innerText.search(value), value.length);
        }
      });
    } else {
      foundItems.forEach(link => {
        const tbody = document.querySelector('.clients__tbody');
        tbody.innerHTML = '';
        clients.forEach(client => tbody.append(ctreateClientItem(client)));

        link.classList.remove('hide');
        findList.classList.add('hide');
        link.innerHTML = link.innerText;
      })
    }
  });

  const insertMark = (str, pos, len) => str
    .slice(0, pos) + '<mark>' + str
      .slice(pos, pos + len) + '</mark>' + str
        .slice(pos + len);
}



const createApp = async () => {

  const header = createHeader();
  const section = createSection();
  document.body.append(header, section.main);
  const preloader = document.querySelector('.preloader');

  try {
    const clients = await getClients();
    searchClients(clients);

    for (const client of clients) {
      document.querySelector('.clients__tbody').append(ctreateClientItem(client));
    }

  } catch (error) {
    console.log(error);
  } finally {
    setTimeout(() => preloader.remove(), 1500);
  }

}



createApp();
document.addEventListener('DOMContentLoaded', sortTable);
